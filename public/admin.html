<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BlackThread AI — Admin</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
:root {
  --bg: #050a0e; --surface: #0a1218; --border: #0f2a3a; --text: #e0f0f8;
  --text-muted: #5a8a9a; --accent: #00e5ff; --teal: #00bfa5; --glow: rgba(0,229,255,0.4);
}
body {
  font-family: 'Inter', -apple-system, sans-serif; background: var(--bg); color: var(--text);
  min-height: 100vh; -webkit-font-smoothing: antialiased;
}
#matrix-bg {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  z-index: 0; opacity: 0.05; pointer-events: none;
}
body::after {
  content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,229,255,0.015) 2px, rgba(0,229,255,0.015) 4px);
  pointer-events: none; z-index: 1;
}

/* AUTH OVERLAY */
#auth-overlay {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 200;
  background: var(--bg); display: flex; align-items: center; justify-content: center;
}
#auth-overlay.hidden { display: none; }
.auth-card {
  background: var(--surface); border: 1px solid var(--border); border-radius: 20px;
  padding: 48px; text-align: center; max-width: 400px; width: 90%;
  position: relative;
}
.auth-card::before {
  content: ''; position: absolute; top: -1px; left: 20%; right: 20%; height: 1px;
  background: linear-gradient(90deg, transparent, var(--accent), transparent);
}
.auth-card h2 {
  font-family: 'JetBrains Mono', monospace; font-size: 14px; text-transform: uppercase;
  letter-spacing: 0.1em; color: var(--accent); margin-bottom: 24px;
  text-shadow: 0 0 10px var(--glow);
}
.auth-card input {
  width: 100%; padding: 14px 16px; background: rgba(0,229,255,0.03);
  border: 1px solid var(--border); border-radius: 12px; color: var(--text);
  font-family: 'JetBrains Mono', monospace; font-size: 14px; text-align: center;
  margin-bottom: 16px;
}
.auth-card input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 20px rgba(0,229,255,0.1); }
.auth-card button {
  width: 100%; padding: 14px; background: linear-gradient(135deg, var(--teal), var(--accent));
  color: #050a0e; font-weight: 700; font-size: 14px; border: none; border-radius: 12px;
  cursor: pointer; text-transform: uppercase; letter-spacing: 0.05em;
}
.auth-error { color: #ff5252; font-size: 13px; margin-top: 12px; display: none; }

/* DASHBOARD */
#dashboard { display: none; position: relative; z-index: 2; padding: 32px 24px; max-width: 1100px; margin: 0 auto; }
#dashboard.visible { display: block; }
.dash-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 32px; flex-wrap: wrap; gap: 16px;
}
.dash-header h1 {
  font-family: 'JetBrains Mono', monospace; font-size: 18px; text-transform: uppercase;
  letter-spacing: 0.1em; color: var(--accent); text-shadow: 0 0 10px var(--glow);
}
.refresh-btn {
  padding: 10px 20px; background: transparent; border: 1px solid var(--border);
  color: var(--text-muted); border-radius: 8px; cursor: pointer; font-family: 'JetBrains Mono', monospace;
  font-size: 12px; text-transform: uppercase; letter-spacing: 0.05em; transition: all 0.3s;
}
.refresh-btn:hover { border-color: var(--accent); color: var(--accent); }

.stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 32px; }
.stat-card {
  background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px;
}
.stat-card .label { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; font-family: 'JetBrains Mono', monospace; }
.stat-card .value { font-size: 28px; font-weight: 700; color: var(--accent); margin-top: 4px; }

table { width: 100%; border-collapse: collapse; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
thead th {
  padding: 14px 16px; text-align: left; font-family: 'JetBrains Mono', monospace;
  font-size: 11px; text-transform: uppercase; letter-spacing: 0.1em;
  color: var(--text-muted); border-bottom: 1px solid var(--border); background: rgba(0,229,255,0.03);
}
tbody td { padding: 14px 16px; border-bottom: 1px solid var(--border); font-size: 14px; vertical-align: top; }
tbody tr { cursor: pointer; transition: background 0.2s; }
tbody tr:hover { background: rgba(0,229,255,0.03); }
.status-badge {
  display: inline-block; padding: 3px 10px; border-radius: 20px;
  font-family: 'JetBrains Mono', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em;
}
.status-badge.paid { background: rgba(0,230,118,0.1); color: #00e676; border: 1px solid rgba(0,230,118,0.2); }
.status-badge.pending { background: rgba(255,193,7,0.1); color: #ffc107; border: 1px solid rgba(255,193,7,0.2); }
.idea-full { display: none; padding: 12px 0 4px; color: var(--text-muted); font-size: 13px; line-height: 1.6; white-space: pre-wrap; }
.idea-full.open { display: block; }
.empty { text-align: center; padding: 60px 24px; color: var(--text-muted); }

@media (max-width: 768px) {
  table, thead, tbody, th, td, tr { display: block; }
  thead { display: none; }
  tbody td { padding: 8px 16px; border: none; }
  tbody td::before { content: attr(data-label); display: block; font-size: 10px; color: var(--text-muted); text-transform: uppercase; font-family: 'JetBrains Mono', monospace; margin-bottom: 2px; }
  tbody tr { border-bottom: 1px solid var(--border); padding: 8px 0; }
}
</style>
</head>
<body>
<canvas id="matrix-bg"></canvas>

<div id="auth-overlay">
  <div class="auth-card">
    <h2>// Admin Access</h2>
    <input type="password" id="password" placeholder="Enter password" autofocus>
    <button onclick="authenticate()">Authenticate</button>
    <div class="auth-error" id="auth-error">Access denied. Invalid password.</div>
  </div>
</div>

<div id="dashboard">
  <div class="dash-header">
    <h1>// Submissions Dashboard</h1>
    <button class="refresh-btn" onclick="loadSubmissions()">↻ Refresh</button>
  </div>
  <div class="stats">
    <div class="stat-card"><div class="label">Total</div><div class="value" id="stat-total">0</div></div>
    <div class="stat-card"><div class="label">Paid</div><div class="value" id="stat-paid">0</div></div>
    <div class="stat-card"><div class="label">Pending</div><div class="value" id="stat-pending">0</div></div>
    <div class="stat-card"><div class="label">Revenue</div><div class="value" id="stat-revenue">$0</div></div>
  </div>
  <table>
    <thead><tr><th>Date</th><th>Email</th><th>Idea</th><th>Status</th></tr></thead>
    <tbody id="submissions-body"></tbody>
  </table>
</div>

<script>
let adminPassword = '';

document.getElementById('password').addEventListener('keydown', e => { if (e.key === 'Enter') authenticate(); });

async function authenticate() {
  adminPassword = document.getElementById('password').value;
  try {
    const res = await fetch('/api/submissions', { headers: { 'X-Admin-Password': adminPassword } });
    if (res.ok) {
      document.getElementById('auth-overlay').classList.add('hidden');
      document.getElementById('dashboard').classList.add('visible');
      const data = await res.json();
      renderSubmissions(data.submissions);
    } else {
      document.getElementById('auth-error').style.display = 'block';
    }
  } catch {
    document.getElementById('auth-error').style.display = 'block';
  }
}

async function loadSubmissions() {
  const res = await fetch('/api/submissions', { headers: { 'X-Admin-Password': adminPassword } });
  if (res.ok) {
    const data = await res.json();
    renderSubmissions(data.submissions);
  }
}

function renderSubmissions(subs) {
  document.getElementById('stat-total').textContent = subs.length;
  document.getElementById('stat-paid').textContent = subs.filter(s => s.status === 'paid').length;
  document.getElementById('stat-pending').textContent = subs.filter(s => s.status === 'pending').length;
  const revenue = subs.filter(s => s.status === 'paid').reduce((sum, s) => sum + (s.amountPaid || 150000), 0);
  document.getElementById('stat-revenue').textContent = '$' + (revenue / 100).toLocaleString();

  const tbody = document.getElementById('submissions-body');
  if (subs.length === 0) {
    tbody.innerHTML = '<tr><td colspan="4" class="empty">No submissions yet</td></tr>';
    return;
  }
  tbody.innerHTML = subs.map((s, i) => {
    const date = new Date(s.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit' });
    const excerpt = s.idea ? (s.idea.length > 80 ? s.idea.substring(0, 80) + '…' : s.idea) : '—';
    return `<tr onclick="this.querySelector('.idea-full').classList.toggle('open')">
      <td data-label="Date">${date}</td>
      <td data-label="Email">${s.email || '—'}</td>
      <td data-label="Idea">${excerpt}<div class="idea-full">${s.idea || ''}</div></td>
      <td data-label="Status"><span class="status-badge ${s.status}">${s.status}</span></td>
    </tr>`;
  }).join('');
}

// Matrix rain
const canvas = document.getElementById('matrix-bg');
const ctx = canvas.getContext('2d');
canvas.width = innerWidth; canvas.height = innerHeight;
const chars = 'アイウエオカキクケコ01'; const fontSize = 14;
const columns = Math.floor(canvas.width / fontSize);
const drops = Array(columns).fill(1);
function draw() {
  ctx.fillStyle = 'rgba(5,10,14,0.1)'; ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = '#00e5ff'; ctx.font = fontSize + 'px monospace';
  for (let i = 0; i < drops.length; i++) {
    ctx.fillText(chars[Math.floor(Math.random() * chars.length)], i * fontSize, drops[i] * fontSize);
    if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
    drops[i]++;
  }
}
setInterval(draw, 50);
addEventListener('resize', () => { canvas.width = innerWidth; canvas.height = innerHeight; });
</script>
</body>
</html>
